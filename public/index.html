<html>
    <head>
        <title> Web RTS Front End</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
    </head>
    <body>
        <ul id="nav_bar">
            <li>Account</li>
            <li>Game Lobbies</li>
        </ul>

        <button id="add_lobby"> <a href="#open_lobby" rel="modal:open"> New Lobby </a></button>
        <button id="refresh_lobby"> Refresh </button>

        <ul id="game_room">
        </ul>

        <div id="open_lobby" class="modal">
            <form action="">
                Game Name:
                <input type="text" autocomplete="off" id="game_name"><br>
                <button> Create Room </button>
            </form>
        </div>


        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
        <script>
            var socket = io();
            var game_rooms = [];

            $(document).ready(function () {

            });

            $('#refresh_lobby').on('click', function(){
                refreshList();
            });

            $('#game_room').on('click', "button.join_room", function(){
                let gameRoom = game_rooms[$(this).parent().index()];
                sessionStorage.setItem('game_lobby', JSON.stringify(gameRoom));
                joinRoom(JSON.stringify(gameRoom));
            });

            $('form').on('submit', function () {
                socket.emit('add and join', $('#game_name').val());
                $('#game_name').val("");
            });

            socket.on('add room', function(gameRoomJSON){
                addRoom(gameRoomJSON);
            });

            socket.on('join room', function(gameRoomJSON){
                sessionStorage.setItem('game_lobby', gameRoomJSON);
                joinRoom(gameRoomJSON);
            });

            socket.on('get_player', function(playerJSON){
                sessionStorage.setItem('player', playerJSON);
            });

            function refreshList() {
                $('#game_room').empty();
                game_rooms = [];
                socket.emit('refresh');
            }

            function addRoom(gameRoomJSON) {
                let gameRoom = JSON.parse(gameRoomJSON);
                game_rooms.push(gameRoom);
                $('#game_room').append("<li>" + gameRoom.name + "<button class='join_room'> Join Room</button></li>");
            }

            function joinRoom(gameRoomJSON) {
                socket.emit('join_room', gameRoomJSON);
                window.location.href = "game_room.html";
            }
        </script>
    </body>
</html>
