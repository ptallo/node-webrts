<html>
    <head>
        <title> Web RTS Front End</title>
        <link rel="stylesheet" type="text/css" href="style.css" />
    </head>
    <body>
        <ul id="nav_bar">
            <li>Account</li>
            <li>Game Lobbies</li>
        </ul>

        <button id="add_lobby"> Add Lobby </button>
        <button id="refresh_lobby"> Refresh </button>

        <ul id="game_room">
        </ul>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script>
            var socket = io();
            var game_rooms = [];

            $(document).ready(function () {
                if (localStorage.get('player_id') == null) {
                    socket.emit('get_uid');
                }
            });

            $('#add_lobby').on('click', function(){
                socket.emit('add lobby');
            });

            $('#refresh_lobby').on('click', function(){
                refreshList();
            });

            $('#game_room').on('click', "button.join_room", function(){
                let game_room = game_rooms[$(this).parent().index()];
                game_room.players.push(localStorage.getItem('player_id'));
                localStorage.setItem('game_room', JSON.stringify(game_room));
                socket.emit('join_room', JSON.stringify(game_room), localStorage.getItem('player_id'));
                window.location.href = "game_room.html";
            });

            $('#game_room').on('click', "button.leave_room", function(){
                let game_room = game_rooms[$(this).parent().index()];
                socket.emit('leave_room', JSON.stringify(game_room), localStorage.getItem('player_id'));
                refreshList();
            });

            socket.on('add room', function(json){
                let game_room = JSON.parse(json);
                game_rooms.push(game_room);
                $('#game_room').append("<li>" + game_room.game_id + "<button class='join_room'> Join Room</button><button class='leave_room'> Leave Room</button></li>");
            });

            socket.on('get_uid', function(uid){
                localStorage.setItem('player_id', uid);
            });

            function refreshList() {
                $('#game_room').empty();
                game_rooms = [];
                socket.emit('refresh');
            }

            //TODO implement popup for create game which gets some information which will be passed into game constructor
        </script>
    </body>
</html>
